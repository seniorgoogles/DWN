import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from io import StringIO

# CSV data
csv_data = """luts_num,bits,fp_accuracy,quant_accuracy,accuracy_drop
200,FP32,74.88012048192772,74.88012048192772,0.0
200,32,74.88012048192772,74.86265060240964,0.017469879518072773
200,31,74.88012048192772,74.86265060240964,0.017469879518072773
200,30,74.88012048192772,74.86265060240964,0.017469879518072773
200,29,74.88012048192772,74.86265060240964,0.017469879518072773
200,28,74.88012048192772,74.86265060240964,0.017469879518072773
200,27,74.88012048192772,74.86265060240964,0.017469879518072773
200,26,74.88012048192772,74.8578313253012,0.02228915662650932
200,25,74.88012048192772,74.86626506024096,0.013855421686748137
200,24,74.88012048192772,74.86024096385542,0.019879518072296598
200,23,74.88012048192772,74.8277108433735,0.05240963855421832
200,22,74.88012048192772,74.83614457831325,0.043975903614457135
200,21,74.88012048192772,74.83614457831325,0.043975903614457135
200,20,74.88012048192772,74.84759036144578,0.03253012048193282
200,19,74.88012048192772,74.87831325301205,0.0018072289156623178
200,18,74.88012048192772,74.83975903614459,0.0403614457831325
200,17,74.88012048192772,74.894578313253,-0.014457831325298542
200,16,74.88012048192772,74.86204819277108,0.01807228915663428
200,15,74.88012048192772,74.8277108433735,0.05240963855421832
200,14,74.88012048192772,74.84036144578313,0.039759036144582094
200,13,74.88012048192772,74.84156626506024,0.03855421686747018
200,12,74.88012048192772,74.7933734939759,0.08674698795181346
200,11,74.88012048192772,74.85240963855422,0.027710843373496274
200,10,74.88012048192772,74.78795180722891,0.09216867469880041
200,9,74.88012048192772,74.65542168674699,0.22469879518072222
200,8,74.88012048192772,74.39698795180722,0.4831325301204892
200,7,74.88012048192772,73.97710843373494,0.903012048192775
200,6,74.88012048192772,73.16987951807229,1.710240963855425
200,5,74.88012048192772,72.15602409638554,2.724096385542174
200,4,74.88012048192772,56.982530120481925,17.897590361445793
200,3,74.88012048192772,43.4066265060241,31.473493975903615
150,FP32,74.80481927710844,74.80481927710844,0.0
150,32,74.80481927710844,74.80240963855421,0.0024096385542238252
150,31,74.80481927710844,74.80240963855421,0.0024096385542238252
150,30,74.80481927710844,74.80240963855421,0.0024096385542238252
150,29,74.80481927710844,74.80240963855421,0.0024096385542238252
150,28,74.80481927710844,74.80240963855421,0.0024096385542238252
150,27,74.80481927710844,74.80060240963854,0.004216867469886143
150,26,74.80481927710844,74.77710843373494,0.027710843373496274
150,25,74.80481927710844,74.7487951807229,0.056024096385542954
150,24,74.80481927710844,74.73313253012049,0.07168674698795341
150,23,74.80481927710844,74.75301204819277,0.05180722891566791
150,22,74.80481927710844,74.73855421686747,0.06626506024096646
150,21,74.80481927710844,74.74819277108433,0.05662650602410446
150,20,74.80481927710844,74.76204819277108,0.042771084337356324
150,19,74.80481927710844,74.74337349397591,0.06144578313252991
150,18,74.80481927710844,74.75301204819277,0.05180722891566791
150,17,74.80481927710844,74.76987951807229,0.034939759036145546
150,16,74.80481927710844,74.73915662650602,0.06566265060241605
150,15,74.80481927710844,74.7355421686747,0.06927710843374069
150,14,74.80481927710844,74.71867469879518,0.08614457831325195
150,13,74.80481927710844,74.76385542168674,0.040963855421694007
150,12,74.80481927710844,74.67289156626506,0.1319277108433714
150,11,74.80481927710844,74.77771084337348,0.02710843373494587
150,10,74.80481927710844,74.71024096385543,0.09457831325301314
150,9,74.80481927710844,74.58313253012048,0.2216867469879591
150,8,74.80481927710844,74.31204819277109,0.4927710843373512
150,7,74.80481927710844,73.98734939759036,0.8174698795180735
150,6,74.80481927710844,73.08493975903615,1.719879518072287
150,5,74.80481927710844,72.63674698795181,2.1680722891566306
150,4,74.80481927710844,57.23915662650603,17.56566265060241
150,3,74.80481927710844,40.57590361445783,34.22891566265061
100,FP32,74.74759036144579,74.74759036144579,0.0
100,32,74.74759036144579,74.74216867469879,0.005421686746986953
100,31,74.74759036144579,74.74216867469879,0.005421686746986953
100,30,74.74759036144579,74.74216867469879,0.005421686746986953
100,29,74.74759036144579,74.74216867469879,0.005421686746986953
100,28,74.74759036144579,74.74216867469879,0.005421686746986953
100,27,74.74759036144579,74.74216867469879,0.005421686746986953
100,26,74.74759036144579,74.72048192771085,0.027108433734934767
100,25,74.74759036144579,74.68192771084338,0.06566265060240495
100,24,74.74759036144579,74.67951807228916,0.06807228915662877
100,23,74.74759036144579,74.67168674698796,0.07590361445782845
100,22,74.74759036144579,74.69277108433735,0.05481927710843104
100,21,74.74759036144579,74.65060240963855,0.09698795180722586
100,20,74.74759036144579,74.65,0.09759036144577626
100,19,74.74759036144579,74.66626506024096,0.0813253012048154
100,18,74.74759036144579,74.70240963855422,0.04518072289156905
100,17,74.74759036144579,74.6789156626506,0.06867469879517918
100,16,74.74759036144579,74.6656626506024,0.08192771084337691
100,15,74.74759036144579,74.70722891566265,0.0403614457831325
100,14,74.74759036144579,74.67048192771084,0.07710843373494036
100,13,74.74759036144579,74.68734939759037,0.060240963855417995
100,12,74.74759036144579,74.65301204819276,0.09457831325301314
100,11,74.74759036144579,74.73012048192771,0.017469879518072773
100,10,74.74759036144579,74.66084337349398,0.08674698795180236
100,9,74.74759036144579,74.63493975903614,0.11265060240963631
100,8,74.74759036144579,74.60301204819277,0.14457831325300763
100,7,74.74759036144579,74.24638554216868,0.5012048192771013
100,6,74.74759036144579,74.04759036144578,0.7000000000000006
100,5,74.74759036144579,73.47469879518073,1.2728915662650553
100,4,74.74759036144579,58.17951807228916,16.56807228915662
100,3,74.74759036144579,44.04216867469879,30.705421686746988
50,FP32,73.96144578313253,73.96144578313253,0.0
50,32,73.96144578313253,73.95602409638555,0.005421686746986953
50,31,73.96144578313253,73.95602409638555,0.005421686746986953
50,30,73.96144578313253,73.95602409638555,0.005421686746986953
50,29,73.96144578313253,73.95602409638555,0.005421686746986953
50,28,73.96144578313253,73.95602409638555,0.005421686746986953
50,27,73.96144578313253,73.95602409638555,0.005421686746986953
50,26,73.96144578313253,73.95542168674699,0.006024096385537359
50,25,73.96144578313253,73.93253012048193,0.028915662650597085
50,24,73.96144578313253,73.93734939759035,0.02409638554217164
50,23,73.96144578313253,73.93975903614458,0.021686746987947814
50,22,73.96144578313253,73.9355421686747,0.025903614457833957
50,21,73.96144578313253,73.95361445783134,0.007831325301199676
50,20,73.96144578313253,73.96746987951808,-0.006024096385548461
50,19,73.96144578313253,73.94759036144578,0.013855421686748137
50,18,73.96144578313253,73.94578313253012,0.015662650602410455
50,17,73.96144578313253,73.9355421686747,0.025903614457833957
50,16,73.96144578313253,73.94216867469879,0.01927710843373509
50,15,73.96144578313253,73.93795180722891,0.02349397590361013
50,14,73.96144578313253,73.9355421686747,0.025903614457833957
50,13,73.96144578313253,73.93795180722891,0.02349397590361013
50,12,73.96144578313253,73.92289156626506,0.03855421686747018
50,11,73.96144578313253,73.9367469879518,0.024698795180722044
50,10,73.96144578313253,73.92710843373494,0.03433734939758404
50,9,73.96144578313253,73.95843373493976,0.0030120481927742304
50,8,73.96144578313253,73.88253012048193,0.07891566265060268
50,7,73.96144578313253,73.66506024096385,0.29638554216867563
50,6,73.96144578313253,73.61144578313254,0.34999999999999476
50,5,73.96144578313253,73.03855421686747,0.9228915662650605
50,4,73.96144578313253,58.007831325301204,15.953614457831321
50,3,73.96144578313253,44.31807228915663,29.6433734939759
40,FP32,73.30060240963854,73.30060240963854,0.0
40,32,73.30060240963854,73.29879518072289,0.0018072289156623178
40,31,73.30060240963854,73.29879518072289,0.0018072289156623178
40,30,73.30060240963854,73.29879518072289,0.0018072289156623178
40,29,73.30060240963854,73.29879518072289,0.0018072289156623178
40,28,73.30060240963854,73.29879518072289,0.0018072289156623178
40,27,73.30060240963854,73.29879518072289,0.0018072289156623178
40,26,73.30060240963854,73.29879518072289,0.0018072289156623178
40,25,73.30060240963854,73.29698795180722,0.0036144578313246356
40,24,73.30060240963854,73.30060240963854,0.0
40,23,73.30060240963854,73.29518072289156,0.005421686746986953
40,22,73.30060240963854,73.28433734939759,0.01626506024096086
40,21,73.30060240963854,73.29156626506024,0.009036144578311589
40,20,73.30060240963854,73.3156626506024,-0.01506024096386005
40,19,73.30060240963854,73.30542168674698,-0.004819277108436548
40,18,73.30060240963854,73.31084337349397,-0.010240963855423502
40,17,73.30060240963854,73.30361445783133,-0.0030120481927742304
40,16,73.30060240963854,73.31084337349397,-0.010240963855423502
40,15,73.30060240963854,73.29819277108433,0.002409638554212723
40,14,73.30060240963854,73.30060240963854,0.0
40,13,73.30060240963854,73.29036144578313,0.0102409638554124
40,12,73.30060240963854,73.30602409638554,-0.005421686746998056
40,11,73.30060240963854,73.30963855421687,-0.009036144578322691
40,10,73.30060240963854,73.28192771084338,0.018674698795173583
40,9,73.30060240963854,73.26626506024097,0.03433734939758404
40,8,73.30060240963854,73.21445783132529,0.08614457831325195
40,7,73.30060240963854,73.05843373493975,0.242168674698795
40,6,73.30060240963854,72.99096385542168,0.30963855421686226
40,5,73.30060240963854,72.67048192771084,0.6301204819277095
40,4,73.30060240963854,57.0566265060241,16.243975903614448
40,3,73.30060240963854,44.755421686746985,28.545180722891562
30,FP32,72.58253012048192,72.58253012048192,0.0
30,32,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,31,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,30,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,29,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,28,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,27,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,26,72.58253012048192,72.58313253012048,-0.0006024096385615074
30,25,72.58253012048192,72.55301204819277,0.029518072289158592
30,24,72.58253012048192,72.5409638554217,0.04156626506023331
30,23,72.58253012048192,72.52469879518073,0.05783132530120527
30,22,72.58253012048192,72.53734939759036,0.04518072289156905
30,21,72.58253012048192,72.49096385542168,0.0915662650602389
30,20,72.58253012048192,72.50481927710844,0.07771084337349077
30,19,72.58253012048192,72.51566265060241,0.06686746987951686
30,18,72.58253012048192,72.51265060240964,0.06987951807229109
30,17,72.58253012048192,72.55,0.03253012048192172
30,16,72.58253012048192,72.5012048192771,0.0813253012048154
30,15,72.58253012048192,72.5433734939759,0.039156626506020586
30,14,72.58253012048192,72.4933734939759,0.08915662650602618
30,13,72.58253012048192,72.51024096385542,0.07228915662650381
30,12,72.58253012048192,72.50361445783132,0.07891566265060268
30,11,72.58253012048192,72.5132530120482,0.06927710843372958
30,10,72.58253012048192,72.55602409638554,0.026506024096384362
30,9,72.58253012048192,72.52650602409638,0.056024096385542954
30,8,72.58253012048192,72.5132530120482,0.06927710843372958
30,7,72.58253012048192,72.26867469879518,0.3138554216867484
30,6,72.58253012048192,72.27650602409639,0.3060240963855376
30,5,72.58253012048192,72.03012048192771,0.5524096385542188
30,4,72.58253012048192,57.0855421686747,15.496987951807228
30,3,72.58253012048192,44.27590361445783,28.306626506024095
20,FP32,72.00963855421688,72.00963855421688,0.0
20,32,72.00963855421688,72.0090361445783,0.0006024096385615074
20,31,72.00963855421688,72.0090361445783,0.0006024096385615074
20,30,72.00963855421688,72.0090361445783,0.0006024096385615074
20,29,72.00963855421688,72.0090361445783,0.0006024096385615074
20,28,72.00963855421688,72.0090361445783,0.0006024096385615074
20,27,72.00963855421688,72.0090361445783,0.0006024096385615074
20,26,72.00963855421688,72.01385542168674,-0.004216867469875041
20,25,72.00963855421688,72.01144578313253,-0.0018072289156623178
20,24,72.00963855421688,72.00843373493976,0.0012048192771119126
20,23,72.00963855421688,72.00421686746988,0.005421686746986953
20,22,72.00963855421688,71.97710843373494,0.03253012048193282
20,21,72.00963855421688,71.96807228915662,0.04156626506024441
20,20,72.00963855421688,71.97530120481927,0.03433734939759514
20,19,72.00963855421688,71.99698795180723,0.012650602409636225
20,18,72.00963855421688,72.00361445783132,0.006024096385548461
20,17,72.00963855421688,72.02349397590362,-0.013855421686748137
20,16,72.00963855421688,71.97289156626506,0.036746987951807863
20,15,72.00963855421688,72.00602409638554,0.0036144578313246356
20,14,72.00963855421688,71.99277108433735,0.016867469879522368
20,13,72.00963855421688,72.0210843373494,-0.011445783132524312
20,12,72.00963855421688,71.97590361445783,0.03373493975903363
20,11,72.00963855421688,71.98132530120482,0.02831325301204668
20,10,72.00963855421688,71.9777108433735,0.031927710843371315
20,9,72.00963855421688,71.94578313253011,0.06385542168675373
20,8,72.00963855421688,71.95481927710843,0.054819277108442144
20,7,72.00963855421688,71.4867469879518,0.5228915662650602
20,6,72.00963855421688,71.46385542168674,0.5457831325301199
20,5,72.00963855421688,72.19638554216867,-0.18674698795180245
20,4,72.00963855421688,57.08373493975903,14.925903614457836
20,3,72.00963855421688,44.08975903614458,27.919879518072293
10,FP32,70.08554216867469,70.08554216867469,0.0
10,32,70.08554216867469,70.08012048192771,0.005421686746986953
10,31,70.08554216867469,70.08012048192771,0.005421686746986953
10,30,70.08554216867469,70.08012048192771,0.005421686746986953
10,29,70.08554216867469,70.08012048192771,0.005421686746986953
10,28,70.08554216867469,70.08012048192771,0.005421686746986953
10,27,70.08554216867469,70.08012048192771,0.005421686746986953
10,26,70.08554216867469,70.03192771084338,0.05361445783131913
10,25,70.08554216867469,70.03132530120482,0.054216867469880636
10,24,70.08554216867469,70.03192771084338,0.05361445783131913
10,23,70.08554216867469,70.01807228915663,0.06746987951806727
10,22,70.08554216867469,69.99518072289158,0.09036144578312699
10,21,70.08554216867469,70.08554216867469,0.0
10,20,70.08554216867469,70.02831325301206,0.057228915662643765
10,19,70.08554216867469,69.97469879518073,0.110843373493974
10,18,70.08554216867469,69.94518072289156,0.1403614457831326
10,17,70.08554216867469,70.02168674698795,0.06385542168674263
10,16,70.08554216867469,70.02650602409639,0.05903614457830608
10,15,70.08554216867469,69.99397590361446,0.0915662650602389
10,14,70.08554216867469,70.02469879518071,0.0608433734939795
10,13,70.08554216867469,70.03373493975904,0.05180722891565681
10,12,70.08554216867469,69.97349397590361,0.11204819277108591
10,11,70.08554216867469,69.92891566265061,0.15662650602409345
10,10,70.08554216867469,69.96867469879518,0.11686746987951135
10,9,70.08554216867469,69.84457831325301,0.24096385542168308
10,8,70.08554216867469,69.65361445783132,0.43192771084337167
10,7,70.08554216867469,69.97168674698796,0.11385542168674823
10,6,70.08554216867469,69.72409638554217,0.3614457831325302
10,5,70.08554216867469,62.33313253012048,7.752409638554214
10,4,70.08554216867469,56.191566265060246,13.893975903614454
10,3,70.08554216867469,44.357831325301206,25.72771084337349"""

# Load the data
df = pd.read_csv(StringIO(csv_data))

# Convert bits column, handling FP32
def convert_bits(bits_val):
    if bits_val == 'FP32':
        return 33  # Position FP32 at the far right for visual ordering
    return int(bits_val)

df['bits_numeric'] = df['bits'].apply(convert_bits)

# Remove FP_BASELINE rows as they're not actual configurations
df_plot = df[df['luts_num'] != 'FP_BASELINE'].copy()
df_plot['luts_num'] = df_plot['luts_num'].astype(int)

# Define colors for each LUT configuration
colors = {
    10: '#FF6B6B',   # Red
    20: '#4ECDC4',   # Teal
    30: '#45B7D1',   # Blue
    40: '#96CEB4',   # Green
    50: '#FECA57',   # Yellow
    100: '#FF9FF3',  # Pink
    150: '#54A0FF',  # Light Blue
    200: '#5F27CD'   # Purple
}

# Create the plot
plt.figure(figsize=(16, 10))

# Plot each LUT configuration
for lut_num in sorted(df_plot['luts_num'].unique()):
    lut_data = df_plot[df_plot['luts_num'] == lut_num]
    
    # Separate points based on accuracy drop
    good_performance = lut_data[abs(lut_data['accuracy_drop']) < 0.1]
    poor_performance = lut_data[abs(lut_data['accuracy_drop']) >= 0.1]
    
    # Plot poor performance points (smaller)
    if not poor_performance.empty:
        plt.scatter(poor_performance['bits_numeric'], poor_performance['quant_accuracy'], 
                   c=colors[lut_num], s=30, alpha=0.7, label=f'{lut_num} LUTs' if lut_num == 10 else "")
    
    # Plot good performance points (larger)
    if not good_performance.empty:
        plt.scatter(good_performance['bits_numeric'], good_performance['quant_accuracy'], 
                   c=colors[lut_num], s=100, alpha=0.8, edgecolors='black', linewidth=1,
                   label=f'{lut_num} LUTs (Good)' if lut_num == 10 else "")

# Customize the plot
plt.xlabel('Quantization Bits', fontsize=14, fontweight='bold')
plt.ylabel('Accuracy (%)', fontsize=14, fontweight='bold')
plt.title('Quantization Analysis: Accuracy vs Bit Width\n(Large points: <0.1% accuracy drop)', 
          fontsize=16, fontweight='bold', pad=20)

# Set x-axis ticks and labels
x_ticks = list(range(3, 33)) + [33]
x_labels = [str(i) for i in range(3, 33)] + ['FP32']
plt.xticks(x_ticks, x_labels, rotation=45)

# Grid
plt.grid(True, alpha=0.3, linestyle='--')

# Create custom legend
from matplotlib.lines import Line2D

legend_elements = []
for lut_num in sorted(df_plot['luts_num'].unique()):
    # Get FP32 accuracy for this LUT configuration
    fp32_acc = df_plot[(df_plot['luts_num'] == lut_num) & (df_plot['bits'] == 'FP32')]['quant_accuracy'].iloc[0]
    legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                                 markerfacecolor=colors[lut_num], markersize=8,
                                 label=f'{lut_num} LUTs (FP32: {fp32_acc:.4f}%)'))

# Add legend for point sizes
legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                             markerfacecolor='gray', markersize=12,
                             markeredgecolor='black', markeredgewidth=1,
                             label='Good Performance (<0.1% drop)'))
legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                             markerfacecolor='gray', markersize=6,
                             label='Higher Accuracy Drop (≥0.1%)'))

plt.legend(handles=legend_elements, loc='lower left', bbox_to_anchor=(0.02, 0.02), 
          frameon=True, fancybox=True, shadow=True, ncol=2, fontsize=10)

# Set y-axis limits to better show the data
y_min = df_plot['quant_accuracy'].min() - 2
y_max = df_plot['quant_accuracy'].max() + 2
plt.ylim(y_min, y_max)

# Tight layout and show
plt.tight_layout()
plt.subplots_adjust(bottom=0.15, top=0.85, left=0.08, right=0.95)
"""
# Add annotation for some key points
# Annotate the best performing configurations
for lut_num in [50, 100, 150, 200]:
    lut_data = df_plot[df_plot['luts_num'] == lut_num]
    if not lut_data.empty:
        best_for_lut = lut_data.loc[lut_data['quant_accuracy'].idxmax()]
        if abs(best_for_lut['accuracy_drop']) < 0.05:  # Only annotate really good ones
            plt.annotate(f'{lut_num}L\n{best_for_lut["bits"]}b', 
                        xy=(best_for_lut['bits_numeric'], best_for_lut['quant_accuracy']),
                        xytext=(5, 5), textcoords='offset points',
                        fontsize=8, ha='left',
                        bbox=dict(boxstyle='round,pad=0.2', fc='white', alpha=0.7))
"""
plt.savefig('quantization_analysis_plot.png', dpi=300)