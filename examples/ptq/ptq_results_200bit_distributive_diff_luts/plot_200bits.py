import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from io import StringIO

# CSV data
csv_data = """luts_num,bits,fp_accuracy,quant_accuracy,accuracy_drop
10,FP32,71.17048192771084,71.17048192771084,0.0
10,32,71.17048192771084,71.17048192771084,0.0
10,31,71.17048192771084,71.17048192771084,0.0
10,30,71.17048192771084,71.17048192771084,0.0
10,29,71.17048192771084,71.17048192771084,0.0
10,28,71.17048192771084,71.17048192771084,0.0
10,27,71.17048192771084,71.17048192771084,0.0
10,26,71.17048192771084,71.16506024096385,0.005421686746986953
10,25,71.17048192771084,71.10361445783133,0.06686746987951686
10,24,71.17048192771084,71.10843373493975,0.06204819277108031
10,23,71.17048192771084,71.10843373493975,0.06204819277108031
10,22,71.17048192771084,71.1198795180723,0.0506024096385449
10,21,71.17048192771084,71.11385542168675,0.05662650602409336
10,20,71.17048192771084,71.16445783132531,0.006024096385537359
10,19,71.17048192771084,71.11746987951807,0.053012048192768724
10,18,71.17048192771084,71.07289156626506,0.09759036144577626
10,17,71.17048192771084,71.10361445783133,0.06686746987951686
10,16,71.17048192771084,71.10361445783133,0.06686746987951686
10,15,71.17048192771084,71.12530120481928,0.045180722891557945
10,14,71.17048192771084,71.12951807228916,0.040963855421682904
10,13,71.17048192771084,71.12951807228916,0.040963855421682904
10,12,71.17048192771084,71.12168674698796,0.04879518072288258
10,11,71.17048192771084,71.05481927710844,0.11566265060239944
10,10,71.17048192771084,71.02831325301204,0.1421686746987949
10,9,71.17048192771084,71.14156626506023,0.028915662650597085
10,8,71.17048192771084,71.16807228915663,0.002409638554212723
10,7,71.17048192771084,70.97951807228917,0.1909638554216775
10,6,71.17048192771084,70.88433734939758,0.28614457831325213
10,5,71.17048192771084,70.36927710843374,0.8012048192771015
10,4,71.17048192771084,56.489759036144584,14.680722891566255
10,3,71.17048192771084,44.008433734939764,27.162048192771078
20,FP32,71.83373493975903,71.83373493975903,0.0
20,32,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,31,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,30,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,29,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,28,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,27,71.83373493975903,71.83614457831325,-0.0024096385542238252
20,26,71.83373493975903,71.8355421686747,-0.00180722891567342
20,25,71.83373493975903,71.74518072289156,0.08855421686746467
20,24,71.83373493975903,71.74397590361446,0.08975903614457659
20,23,71.83373493975903,71.74819277108433,0.08554216867469044
20,22,71.83373493975903,71.74277108433735,0.0909638554216774
20,21,71.83373493975903,71.73734939759036,0.09638554216866435
20,20,71.83373493975903,71.76204819277109,0.0716867469879423
20,19,71.83373493975903,71.74759036144577,0.08614457831325195
20,18,71.83373493975903,71.80722891566265,0.026506024096384362
20,17,71.83373493975903,71.83012048192771,0.0036144578313246356
20,16,71.83373493975903,71.74457831325302,0.08915662650601508
20,15,71.83373493975903,71.82710843373495,0.006626506024087764
20,14,71.83373493975903,71.7487951807229,0.08493975903614004
20,13,71.83373493975903,71.75240963855421,0.0813253012048154
20,12,71.83373493975903,71.74638554216868,0.08734939759035276
20,11,71.83373493975903,71.8156626506024,0.018072289156623178
20,10,71.83373493975903,71.72409638554217,0.10963855421686208
20,9,71.83373493975903,71.83975903614459,-0.006024096385548461
20,8,71.83373493975903,71.75361445783133,0.08012048192770349
20,7,71.83373493975903,71.4343373493976,0.39939759036143885
20,6,71.83373493975903,71.43493975903614,0.39879518072288844
20,5,71.83373493975903,71.47891566265059,0.3548192771084313
20,4,71.83373493975903,56.28012048192771,15.553614457831323
20,3,71.83373493975903,44.05722891566265,27.77650602409638
30,FP32,72.35602409638554,72.35602409638554,0.0
30,32,72.35602409638554,72.34819277108434,0.007831325301199676
30,31,72.35602409638554,72.34819277108434,0.007831325301199676
30,30,72.35602409638554,72.34819277108434,0.007831325301199676
30,29,72.35602409638554,72.34819277108434,0.007831325301199676
30,28,72.35602409638554,72.34819277108434,0.007831325301199676
30,27,72.35602409638554,72.34819277108434,0.007831325301199676
30,26,72.35602409638554,72.3421686746988,0.013855421686748137
30,25,72.35602409638554,72.34397590361445,0.01204819277108582
30,24,72.35602409638554,72.35843373493977,-0.0024096385542238252
30,23,72.35602409638554,72.33855421686746,0.017469879518072773
30,22,72.35602409638554,72.3132530120482,0.04277108433734522
30,21,72.35602409638554,72.32951807228916,0.026506024096384362
30,20,72.35602409638554,72.34397590361445,0.01204819277108582
30,19,72.35602409638554,72.32650602409637,0.029518072289158592
30,18,72.35602409638554,72.33433734939759,0.021686746987947814
30,17,72.35602409638554,72.32289156626506,0.03313253012048323
30,16,72.35602409638554,72.32590361445783,0.030120481927708997
30,15,72.35602409638554,72.33734939759037,0.018674698795173583
30,14,72.35602409638554,72.28614457831326,0.06987951807229109
30,13,72.35602409638554,72.33012048192771,0.025903614457833957
30,12,72.35602409638554,72.28192771084338,0.07409638554216613
30,11,72.35602409638554,72.30722891566265,0.04879518072289368
30,10,72.35602409638554,72.32048192771084,0.03554216867469595
30,9,72.35602409638554,72.30903614457831,0.046987951807231365
30,8,72.35602409638554,72.31024096385542,0.04578313253011945
30,7,72.35602409638554,72.20120481927711,0.15481927710843113
30,6,72.35602409638554,71.93493975903614,0.42108433734939776
30,5,72.35602409638554,72.22349397590362,0.1325301204819218
30,4,72.35602409638554,57.59397590361446,14.762048192771083
30,3,72.35602409638554,44.367469879518076,27.988554216867467
40,FP32,73.59156626506024,73.59156626506024,0.0
40,32,73.59156626506024,73.57650602409639,0.015060240963848948
40,31,73.59156626506024,73.57650602409639,0.015060240963848948
40,30,73.59156626506024,73.57650602409639,0.015060240963848948
40,29,73.59156626506024,73.57650602409639,0.015060240963848948
40,28,73.59156626506024,73.57650602409639,0.015060240963848948
40,27,73.59156626506024,73.57650602409639,0.015060240963848948
40,26,73.59156626506024,73.5789156626506,0.012650602409636225
40,25,73.59156626506024,73.53915662650601,0.05240963855421832
40,24,73.59156626506024,73.53433734939759,0.057228915662643765
40,23,73.59156626506024,73.53734939759036,0.054216867469880636
40,22,73.59156626506024,73.54759036144578,0.043975903614457135
40,21,73.59156626506024,73.56566265060242,0.025903614457822854
40,20,73.59156626506024,73.55361445783133,0.037951807228908674
40,19,73.59156626506024,73.54879518072289,0.04277108433734522
40,18,73.59156626506024,73.54819277108435,0.04337349397589563
40,17,73.59156626506024,73.55843373493975,0.03313253012048323
40,16,73.59156626506024,73.55060240963856,0.040963855421682904
40,15,73.59156626506024,73.55421686746988,0.03734939759035827
40,14,73.59156626506024,73.55301204819277,0.03855421686747018
40,13,73.59156626506024,73.56084337349398,0.030722891566259403
40,12,73.59156626506024,73.54638554216868,0.045180722891557945
40,11,73.59156626506024,73.56204819277107,0.029518072289158592
40,10,73.59156626506024,73.53373493975903,0.05783132530120527
40,9,73.59156626506024,73.53132530120482,0.060240963855417995
40,8,73.59156626506024,73.50602409638554,0.08554216867469044
40,7,73.59156626506024,73.3710843373494,0.22048192771083608
40,6,73.59156626506024,73.34277108433736,0.24879518072288276
40,5,73.59156626506024,72.94216867469879,0.6493975903614446
40,4,73.59156626506024,57.73373493975904,15.857831325301197
40,3,73.59156626506024,44.2433734939759,29.348192771084335
50,FP32,73.95843373493976,73.95843373493976,0.0
50,32,73.95843373493976,73.95843373493976,0.0
50,31,73.95843373493976,73.95843373493976,0.0
50,30,73.95843373493976,73.95843373493976,0.0
50,29,73.95843373493976,73.95843373493976,0.0
50,28,73.95843373493976,73.95843373493976,0.0
50,27,73.95843373493976,73.95843373493976,0.0
50,26,73.95843373493976,73.9578313253012,0.0006024096385504052
50,25,73.95843373493976,73.95602409638555,0.002409638554212723
50,24,73.95843373493976,73.95843373493976,0.0
50,23,73.95843373493976,73.93614457831326,0.02228915662649822
50,22,73.95843373493976,73.93915662650602,0.01927710843373509
50,21,73.95843373493976,73.94216867469879,0.01626506024096086
50,20,73.95843373493976,73.9355421686747,0.022891566265059726
50,19,73.95843373493976,73.944578313253,0.013855421686748137
50,18,73.95843373493976,73.9367469879518,0.021686746987947814
50,17,73.95843373493976,73.93975903614458,0.018674698795173583
50,16,73.95843373493976,73.94277108433734,0.015662650602410455
50,15,73.95843373493976,73.95421686746988,0.004216867469875041
50,14,73.95843373493976,73.93132530120482,0.027108433734934767
50,13,73.95843373493976,73.9487951807229,0.009638554216861994
50,12,73.95843373493976,73.91867469879519,0.03975903614457099
50,11,73.95843373493976,73.93614457831326,0.02228915662649822
50,10,73.95843373493976,73.94277108433734,0.015662650602410455
50,9,73.95843373493976,73.91084337349398,0.04759036144578177
50,8,73.95843373493976,73.85722891566266,0.1012048192771009
50,7,73.95843373493976,73.7066265060241,0.251807228915657
50,6,73.95843373493976,73.54397590361445,0.4144578313252989
50,5,73.95843373493976,73.01566265060241,0.942771084337346
50,4,73.95843373493976,57.88855421686747,16.069879518072284
50,3,73.95843373493976,44.151807228915665,29.80662650602409
100,FP32,74.6578313253012,74.6578313253012,0.0
100,32,74.6578313253012,74.66927710843375,-0.011445783132535414
100,31,74.6578313253012,74.66927710843375,-0.011445783132535414
100,30,74.6578313253012,74.66927710843375,-0.011445783132535414
100,29,74.6578313253012,74.66927710843375,-0.011445783132535414
100,28,74.6578313253012,74.66927710843375,-0.011445783132535414
100,27,74.6578313253012,74.66927710843375,-0.011445783132535414
100,26,74.6578313253012,74.68373493975903,-0.025903614457833957
100,25,74.6578313253012,74.67530120481928,-0.017469879518072773
100,24,74.6578313253012,74.61746987951807,0.0403614457831325
100,23,74.6578313253012,74.61867469879519,0.039156626506020586
100,22,74.6578313253012,74.62951807228916,0.02831325301204668
100,21,74.6578313253012,74.62590361445784,0.031927710843371315
100,20,74.6578313253012,74.63493975903614,0.022891566265059726
100,19,74.6578313253012,74.64096385542169,0.016867469879522368
100,18,74.6578313253012,74.6421686746988,0.015662650602410455
100,17,74.6578313253012,74.67289156626506,-0.01506024096386005
100,16,74.6578313253012,74.6433734939759,0.014457831325298542
100,15,74.6578313253012,74.63674698795181,0.02108433734939741
100,14,74.6578313253012,74.6301204819277,0.027710843373496274
100,13,74.6578313253012,74.62289156626505,0.034939759036145546
100,12,74.6578313253012,74.62710843373493,0.030722891566270505
100,11,74.6578313253012,74.59819277108434,0.05963855421686759
100,10,74.6578313253012,74.6210843373494,0.036746987951807863
100,9,74.6578313253012,74.58313253012048,0.07469879518072764
100,8,74.6578313253012,74.44939759036144,0.20843373493976136
100,7,74.6578313253012,74.18493975903614,0.4728915662650657
100,6,74.6578313253012,73.77650602409639,0.8813253012048161
100,5,74.6578313253012,72.49457831325302,2.163253012048194
100,4,74.6578313253012,58.172891566265065,16.484939759036145
100,3,74.6578313253012,43.00301204819277,31.65481927710843
150,FP32,74.95963855421687,74.95963855421687,0.0
150,32,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,31,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,30,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,29,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,28,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,27,74.95963855421687,74.96024096385541,-0.0006024096385504052
150,26,74.95963855421687,74.94518072289156,0.014457831325298542
150,25,74.95963855421687,74.95180722891567,0.007831325301199676
150,24,74.95963855421687,74.96626506024097,-0.006626506024098866
150,23,74.95963855421687,74.92831325301205,0.03132530120482091
150,22,74.95963855421687,74.95180722891567,0.007831325301199676
150,21,74.95963855421687,74.94216867469879,0.017469879518072773
150,20,74.95963855421687,74.92710843373493,0.03253012048193282
150,19,74.95963855421687,74.94698795180723,0.012650602409636225
150,18,74.95963855421687,74.95843373493976,0.0012048192771119126
150,17,74.95963855421687,74.93855421686747,0.02108433734939741
150,16,74.95963855421687,74.9222891566265,0.03734939759035827
150,15,74.95963855421687,74.94216867469879,0.017469879518072773
150,14,74.95963855421687,74.95722891566265,0.002409638554212723
150,13,74.95963855421687,74.93975903614458,0.019879518072285496
150,12,74.95963855421687,74.94216867469879,0.017469879518072773
150,11,74.95963855421687,74.9487951807229,0.010843373493973907
150,10,74.95963855421687,74.88012048192772,0.07951807228915309
150,9,74.95963855421687,74.855421686747,0.10421686746987513
150,8,74.95963855421687,74.65060240963855,0.30903614457831186
150,7,74.95963855421687,74.12831325301205,0.8313253012048216
150,6,74.95963855421687,73.65240963855422,1.3072289156626504
150,5,74.95963855421687,72.99036144578314,1.9692771084337313
150,4,74.95963855421687,57.839156626506025,17.12048192771084
150,3,74.95963855421687,42.84277108433735,32.116867469879516
200,FP32,74.96686746987952,74.96686746987952,0.0
200,32,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,31,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,30,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,29,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,28,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,27,74.96686746987952,74.96807228915662,-0.0012048192771119126
200,26,74.96686746987952,74.96204819277108,0.004819277108436548
200,25,74.96686746987952,74.95361445783134,0.01325301204818663
200,24,74.96686746987952,74.93614457831326,0.030722891566259403
200,23,74.96686746987952,74.9301204819277,0.036746987951807863
200,22,74.96686746987952,74.93493975903614,0.031927710843371315
200,21,74.96686746987952,74.92590361445784,0.040963855421682904
200,20,74.96686746987952,74.94939759036144,0.017469879518072773
200,19,74.96686746987952,74.93975903614458,0.027108433734934767
200,18,74.96686746987952,74.94156626506025,0.02530120481927245
200,17,74.96686746987952,74.94759036144578,0.01927710843373509
200,16,74.96686746987952,74.93795180722891,0.028915662650597085
200,15,74.96686746987952,74.93253012048193,0.03433734939758404
200,14,74.96686746987952,74.9343373493976,0.03253012048192172
200,13,74.96686746987952,74.94216867469879,0.024698795180722044
200,12,74.96686746987952,74.90301204819278,0.06385542168674263
200,11,74.96686746987952,74.8698795180723,0.09698795180722586
200,10,74.96686746987952,74.90602409638554,0.0608433734939795
200,9,74.96686746987952,74.8789156626506,0.08795180722891427
200,8,74.96686746987952,74.67168674698796,0.2951807228915637
200,7,74.96686746987952,74.48433734939759,0.48253012048192767
200,6,74.96686746987952,74.02650602409638,0.9403614457831333
200,5,74.96686746987952,72.47650602409638,2.490361445783129
200,4,74.96686746987952,57.03433734939759,17.93253012048193
200,3,74.96686746987952,42.577710843373495,32.38915662650602"""

# Load the data
df = pd.read_csv(StringIO(csv_data))

# Convert bits column, handling FP32
def convert_bits(bits_val):
    if bits_val == 'FP32':
        return 33  # Position FP32 at the far right for visual ordering
    return int(bits_val)

df['bits_numeric'] = df['bits'].apply(convert_bits)

# Remove FP_BASELINE rows as they're not actual configurations
df_plot = df[df['luts_num'] != 'FP_BASELINE'].copy()
df_plot['luts_num'] = df_plot['luts_num'].astype(int)

# Define colors for each LUT configuration
colors = {
    10: '#FF6B6B',   # Red
    20: '#4ECDC4',   # Teal
    30: '#45B7D1',   # Blue
    40: '#96CEB4',   # Green
    50: '#FECA57',   # Yellow
    100: '#FF9FF3',  # Pink
    150: '#54A0FF',  # Light Blue
    200: '#5F27CD'   # Purple
}

# Create the plot
plt.figure(figsize=(16, 10))

# Plot each LUT configuration
for lut_num in sorted(df_plot['luts_num'].unique()):
    lut_data = df_plot[df_plot['luts_num'] == lut_num]
    
    # Separate points based on accuracy drop
    good_performance = lut_data[abs(lut_data['accuracy_drop']) < 0.1]
    poor_performance = lut_data[abs(lut_data['accuracy_drop']) >= 0.1]
    
    # Plot poor performance points (smaller)
    if not poor_performance.empty:
        plt.scatter(poor_performance['bits_numeric'], poor_performance['quant_accuracy'], 
                   c=colors[lut_num], s=30, alpha=0.7, label=f'{lut_num} LUTs' if lut_num == 10 else "")
    
    # Plot good performance points (larger)
    if not good_performance.empty:
        plt.scatter(good_performance['bits_numeric'], good_performance['quant_accuracy'], 
                   c=colors[lut_num], s=100, alpha=0.8, edgecolors='black', linewidth=1,
                   label=f'{lut_num} LUTs (Good)' if lut_num == 10 else "")

# Customize the plot
plt.xlabel('Quantization Bits', fontsize=14, fontweight='bold')
plt.ylabel('Accuracy (%)', fontsize=14, fontweight='bold')
plt.title('Quantization Analysis: Accuracy vs Bit Width\n(Large points: <0.1% accuracy drop)', 
          fontsize=16, fontweight='bold', pad=20)

# Set x-axis ticks and labels
x_ticks = list(range(3, 33)) + [33]
x_labels = [str(i) for i in range(3, 33)] + ['FP32']
plt.xticks(x_ticks, x_labels, rotation=45)

# Grid
plt.grid(True, alpha=0.3, linestyle='--')

# Create custom legend
from matplotlib.lines import Line2D

legend_elements = []
for lut_num in sorted(df_plot['luts_num'].unique()):
    # Get FP32 accuracy for this LUT configuration
    fp32_acc = df_plot[(df_plot['luts_num'] == lut_num) & (df_plot['bits'] == 'FP32')]['quant_accuracy'].iloc[0]
    legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                                 markerfacecolor=colors[lut_num], markersize=8,
                                 label=f'{lut_num} LUTs (FP32: {fp32_acc:.4f}%)'))

# Add legend for point sizes
legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                             markerfacecolor='gray', markersize=12,
                             markeredgecolor='black', markeredgewidth=1,
                             label='Good Performance (<0.1% drop)'))
legend_elements.append(Line2D([0], [0], marker='o', color='w', 
                             markerfacecolor='gray', markersize=6,
                             label='Higher Accuracy Drop (≥0.1%)'))

plt.legend(handles=legend_elements, loc='lower left', bbox_to_anchor=(0.02, 0.02), 
          frameon=True, fancybox=True, shadow=True, ncol=2, fontsize=10)

# Set y-axis limits to better show the data
y_min = df_plot['quant_accuracy'].min() - 2
y_max = df_plot['quant_accuracy'].max() + 2
plt.ylim(y_min, y_max)

# Tight layout and show
plt.tight_layout()
plt.subplots_adjust(bottom=0.15, top=0.85, left=0.08, right=0.95)

# Add annotation for some key points
# Annotate the best performing configurations
"""
for lut_num in [50, 100, 150, 200]:
    lut_data = df_plot[df_plot['luts_num'] == lut_num]
    if not lut_data.empty:
        best_for_lut = lut_data.loc[lut_data['quant_accuracy'].idxmax()]
        if abs(best_for_lut['accuracy_drop']) < 0.05:  # Only annotate really good ones
            plt.annotate(f'{lut_num}L\n{best_for_lut["bits"]}b', 
                        xy=(best_for_lut['bits_numeric'], best_for_lut['quant_accuracy']),
                        xytext=(5, 5), textcoords='offset points',
                        fontsize=8, ha='left',
                        bbox=dict(boxstyle='round,pad=0.2', fc='white', alpha=0.7))
"""
plt.savefig('quantization_analysis_plot.png', dpi=300)